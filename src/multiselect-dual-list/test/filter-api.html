<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>multiselect-dual-list: filter API</title>
  <script type="module" src="../../../dist/multiselect-dual-list.js"></script>
</head>
<body>
  <pwc-multiselect-dual-list id="demo" available-label="Available" selected-label="Selected">
    <select multiple name="items">
      <option value="1">Alpha</option>
      <option value="2">Bravo</option>
      <option value="3">Charlie</option>
      <option value="4" selected>Delta</option>
    </select>
  </pwc-multiselect-dual-list>

  <script type="module">
    import { run } from "../../../static/test-harness.js";

    run(async ({ assert, equal, waitFor, log }) => {
      const host = document.getElementById("demo");
      await waitFor(() => host.querySelector(".pwc-msdl-container"), { label: "container rendered" });

      let lastEvent = null;
      host.addEventListener("pwc-multiselect-dual-list:filter", (e) => { lastEvent = e; });

      // --- filterText getter/setter + event ---
      log("filterText property");
      equal(host.filterText, "", "filterText is empty initially");

      host.filterText = "alpha";
      equal(host.filterText, "alpha", "getter returns set value");
      assert(lastEvent, "event dispatched on set");
      equal(lastEvent.detail.filterText, "alpha", "detail.filterText");
      equal(lastEvent.detail.matchCount, 1, "matchCount 1");
      equal(lastEvent.detail.totalCount, 4, "totalCount 4");

      // --- matchCount = 0 ---
      log("no-match case");
      host.filterText = "zzz-no-match";
      equal(lastEvent.detail.matchCount, 0, "matchCount 0 for no-match");

      // --- Filter re-applied after dynamic option change ---
      log("filter persistence across rebuild");
      host.filterText = "alpha";

      const select = host.querySelector("select");
      const opt = document.createElement("option");
      opt.value = "5";
      opt.textContent = "Alpha Two";
      select.appendChild(opt);

      await waitFor(
        () => host.querySelectorAll(".pwc-msdl-available [data-value]").length === 5,
        { label: "new option rendered" }
      );

      equal(lastEvent.detail.matchCount, 2, "matchCount 2 after adding Alpha Two");
      equal(lastEvent.detail.totalCount, 5, "totalCount 5 after rebuild");

      log("done");
    });
  </script>
</body>
</html>
