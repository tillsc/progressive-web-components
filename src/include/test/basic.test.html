<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>include: basic</title>
    <script type="module" src="../../../dist/include.js"></script>
</head>

<body>

<h1>include: basic</h1>

<p>All tests load <a href="./fragment.html"><code>fragment.html</code></a>.</p>

<h2>Basic src</h2>

<pwc-include id="basic" src="./fragment.html"></pwc-include>

<hr>

<h2>Fragment selector <code>fragment=".sidebar"</code></h2>

<pwc-include id="frag-single" src="./fragment.html" fragment=".sidebar"></pwc-include>

<hr>

<h2>Fragment selector <code>fragment=".greeting, .extra"</code></h2>

<pwc-include id="frag-multi" src="./fragment.html" fragment=".greeting, .extra"></pwc-include>

<hr>

<h2>with-scripts</h2>

<pwc-include id="scripted" src="./fragment.html" with-scripts></pwc-include>

<script type="module">
  import { run } from "../../../static/testing/harness.js";
  import * as assert from "../../../static/testing/assert.js";

  run(async ({ waitFor, log }) => {

    // --- Basic src ---

    await log("basic: loads content from src");
    const basic = document.getElementById("basic");
    await waitFor(() => basic.querySelector(".greeting"), { label: "basic content loaded" });
    assert.ok(basic.querySelector(".greeting").textContent.includes("Hello from fragment!"), "greeting text");
    assert.ok(basic.querySelector(".detail"), "detail paragraph present");
    assert.equal(basic.getAttribute("aria-busy"), null, "aria-busy removed after load");

    // --- Fragment selector (single match) ---

    await log("fragment: single match (.sidebar)");
    const fragSingle = document.getElementById("frag-single");
    await waitFor(() => fragSingle.querySelector(".sidebar"), { label: "sidebar loaded" });
    assert.ok(fragSingle.querySelector(".sidebar p"), "sidebar has children");
    assert.ok(!fragSingle.querySelector(".greeting"), "greeting not present in sidebar fragment");

    // --- Fragment selector (multiple matches) ---

    await log("fragment: multiple matches (.greeting, .extra)");
    const fragMulti = document.getElementById("frag-multi");
    await waitFor(() => fragMulti.querySelectorAll("p").length >= 2, { label: "greeting + extra loaded" });
    const paragraphs = fragMulti.querySelectorAll("p");
    assert.equal(paragraphs.length, 2, "exactly 2 paragraphs");
    assert.ok(paragraphs[0].textContent.includes("Hello from fragment!"), "first is greeting");
    assert.ok(paragraphs[1].textContent.includes("Extra paragraph."), "second is extra");

    // --- with-scripts ---

    await log("with-scripts: inline script executed");
    const scripted = document.getElementById("scripted");
    await waitFor(() => scripted.querySelector(".greeting"), { label: "scripted content loaded" });
    await waitFor(
      () => scripted.querySelector(".greeting")?.dataset.scripted === "true",
      { label: "script marked element" }
    );
    assert.equal(scripted.querySelector(".greeting").dataset.scripted, "true", "script set data attribute");

    await log("done");
  });
</script>
</body>
</html>
