<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>auto-submit: basic</title>
  <script type="module" src="../../../dist/auto-submit.js"></script>
  <style>
      pwc-auto-submit[aria-busy="true"] { opacity: 0.5; }
  </style>
</head>

<body>

<h1>auto-submit: basic</h1>

<h2>Local reload</h2>

<pwc-auto-submit id="auto-submit-test" local-reload>
  <form method="get" action="./response.html">
    <label for="first">First</label><br>
    <input id="first" name="first" value="original"><br><br
    <label for="last">Last (with <code>data-auto-submit</code>)</label><br>
    <input id="last" name="last" value="original" data-auto-submit><br><br>
    <label for="color">Color</label><br>
    <input id="color" name="color" value="red">
  </form>
</pwc-auto-submit>

<script type="module">
  import { run } from "../../../static/testing/harness.js";
  import { setValue, waitForEvent } from "../../../static/testing/helpers.js";

  run(async ({ assert, equal, waitFor, log }) => {

    const el = document.getElementById("auto-submit-test");

    await log("precondition: three form fields present");
    equal(el.querySelector("#first").value, "original", "first input has original value");
    equal(el.querySelector("#last").value, "original", "last input has original value");
    equal( el.querySelector("#color").value, "red", "color starts at red");

    await log("local-reload: change color triggers fetch and transclusion");
    const loadPromise = waitForEvent(el, "pwc-auto-submit:load");
    setValue(el.querySelector("#last"), "something else");
    await loadPromise;

    await log("after transclusion: three form fields still present with response values");
    equal(el.querySelector("#first").value, "from auto-submit response", "first input has response value");
    equal(el.querySelector("#last").value, "from auto-submit response", "last input has response value");
    equal(el.querySelector("#color").value, "from auto-submit response", "color input has response value");
    equal(el.getAttribute("aria-busy"), null, "aria-busy removed");

    await log("done");
  });
</script>
</body>
</html>
